# PostsComment_Service
Система для добавления и чтения постов и комментариев с использованием GraphQL

## Описание задачи
Реализовать систему для добавления и чтения постов и комментариев с использованием GraphQL, 
аналогичную комментариям к постам на популярных платформах, таких как Хабр или Reddit. 

### Характеристики системы постов: 
- Можно просмотреть список постов. 
- Можно просмотреть пост и комментарии под ним. 
- Пользователь, написавший пост, может запретить оставление комментариев к своему посту. 

### Характеристики системы комментариев к постам: 
- Комментарии организованы иерархически, позволяя вложенность без ограничений. 
- Длина текста комментария ограничена до, например, 2000 символов. 
- Система пагинации для получения списка комментариев.

## Запуск
### Локальный запуск
1. Клонирование репозитория
2. `docker-compose -f docker-compose1.yaml up -d` - запуск postgres
3. `make test-migration-up` - запуск миграций
4. `go run cmd/main.go` - локальный запуск сервера

### Запуск в Docker
1. Клонирование репозитория
2. `make docker.run` - запуск всех необходимых служб в Docker

В данном случае миграции для базы данных накатятся сами.

### Остановка работы Docker
Для остановки и удаления контейнеров используйте команду `make docker.down`

## API
API описано в в директории [graph](graph\schema.graphql)

Протестировать API можно с помощи Postman (New -> GraphQL -> Schema -> import -> [schema.graphql](graph\schema.graphql))

Для работы с GraphQL была исползована библиоткека [gqlgen](https://gqlgen.com/)

## Реализованный функционал
### Queries
Были реализованы запросы:
- Получение списка постов с пагинацией (указывается номер и размер страницы)
- Получение поста по id 
- Получение комментариев к посту по id поста с пагинацией (указывается номер и размер страницы)
- Получение ответов на коментарии по id коментария

### Mutations
Были реализованы мутации:
- Создание поста (можно указать разрешены ли для него коментарии)
- Создание комментария (можно указать коментарий как ответ на другой коментарий)

### Subscriptions 
Реализована Подписка на комментарии к конкретному посту. 
Для управления подписками был реализован CommentSubcription, с помощью которого можно создавать, 
удалять и передавать информацию слушателям. 

Слушатели представляют собой структуру из канала для комментариев и идентификатора слушателя. 
В данном проекте не реализована работа с пользователями, но в перспективе можно реализовать систему аутентификации, к примеру, на основе JWT токенов.

### Тестирование
Были реализованы unit-тесты для разных слоев программы.
Для создания моков используется [gomock](https://github.com/golang/mock).

### Выбор хранилища данных
Есть возможность выбора хранилища для постов и комментариев: либо PostgeSQL, либо in-memory хранилище.
При локальном запуске для выбора хранилища необходимо указать в [.env](./.env) файле прописать USE_IN_MEMORY=true 
для выбора in-memory хранилища. В других случаях будет использоваться PostgreSQL.

В случае с запуском Docker-контейнеров необхолимо прописать то же значение переменной окружения 
в [docker-compose.yml](docker-compose.yaml) у сервиса app (11 строчка).